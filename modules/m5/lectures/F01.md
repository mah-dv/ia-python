---
layout: instructions
title: Modul 4 - Fil- och felhantering
code: m5
---

# Fel- och filhantering

<iframe src="//www.slideshare.net/slideshow/embed_code/key/6dJtVGncJTLxzR" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/AntonTibblin/ht17-da354a-fel-och-filhantering" title="HT17 - DA354A - Fel- och filhantering" target="_blank">HT17 - DA354A - Fel- och filhantering</a> </strong> from <strong><a href="https://www.slideshare.net/AntonTibblin" target="_blank">Anton Tibblin</a></strong> </div>

[Ni kan även ladda ner föreläsningen här](/assets/pdf/file-error.pdf)

## Dagens exempelkod

### Lite exempel med try except

{% highlight python linenos %}
# Alt. 1
nr = input("Ange en siffra: ")
if nr.isdigit():
    nr = int(nr)
else:
    print("Du angav inte en siffra!")

# Alt. 2
try:
    nr = int(input("Ange en siffra: "))
except:
    print("Du angav inte en siffra!")



def calculate(nr_1, nr_2, operator):
    try:
        result = eval(nr_1 + operator + nr_2)
        print(result)
    except NameError:
        print("Hoppsan, något gick fel! Tänk på att ange giltiga tal och giltig operator")
    except ZeroDivisionError:
        print("Hoppsan, du får inte dela med 0!")
    except:
        print("Grattis du hittade ett nytt fel!")


nr_1 = input("Ange nr 1: ")
nr_2 = input("Ange nr 2: ")
operator = input("Ange operator: ")
calculate(nr_1, nr_2, operator)
{% endhighlight %}

### Att läsa och skriva från/till fil

{% highlight python linenos %}
try:
    my_file = open("demo.txt", "a")
    my_file.write("\nHär är en rad till!")
    my_file.close()
except FileNotFoundError:
    print("Vi kunde inte öqppna filen, kontrollera att den finns!")

# Öppnar filen
my_file = open("Mr-Brightside.txt", "r")
# Läser in varje rad i filen som en lista
lines_in_file = my_file.readlines()
# Stänger filen
my_file.close()
# Vi loopar igenom varje rad i listan
for line in lines_in_file:
    # skriver ut varje rad (tar bort mellanslag & radbrytningar från textfilen)
    print(line.strip())
{% endhighlight %}

### Filen “Mr-Brightside.txt”

{% highlight python linenos %}
Coming out of my cage
And I've been doing just fine
Gotta gotta be down
Because I want it all
It started out with a kiss
How did it end up like this
It was only a kiss, it was only a kiss
Now I'm falling asleep
And she's calling a cab
While he's having a smoke
And she's taking a drag
Now they're going to bed
And my stomach is sick
And it's all in my head
But she's touching his chest
Now, he takes off her dress
Now, let me go

I just can't look its killing me
And taking control
Jealousy, turning saints into the sea
Swimming through sick lullabies
Choking on your alibis
But it's just the price I pay
Destiny is calling me
Open up my eager eyes
Cause I'm Mr Brightside

I'm coming out of my cage
And I've been doing just fine
Gotta gotta be down
Because I want it all
It started out with a kiss
How did it end up like this
It was only a kiss, it was only a kiss
Now I'm falling asleep
And she's calling a cab
While he's having a smoke
And she's taking a drag
Now they're going to bed
And my stomach is sick
And it's all in my head
But she's touching his chest
Now, he takes off her dress
Now, let me go

'Cause I just can't look its killing me
And taking control
Jealousy, turning saints into the sea
Swimming through sick lullabies
Choking on your alibi
But it's just the price I pay
Destiny is calling me
Open up my eager eyes
'Cause I'm Mr Brightside
I never
I never
I never
I never
{% endhighlight %}

### Filmexempel

{% highlight python linenos %}
def main():

    movies = get_movies_from_file("movies.txt")
    
    print("*"*40)
    print("Välkommen till din filmsamling!")
    print("*"*40)

    while True:
        print_menu()

        user_choice = input("Val: ")

        if user_choice == "1":
            show_movies(movies)
        elif user_choice == "2":
            add_movie(movies)
        elif user_choice == "3":
            show_statistics(movies)
        elif user_choice == "4":
            pass
        elif user_choice == "0":
            break
        else:
            print("Felaktigt alternativ, försök igen!")

def print_menu():
    print("Meny")
    print("*"*40)
    print("1) Visa filmer")
    print("2) Lägg till en film")
    print("3) Statistik")
    #print("4) Spara filmerna till fil")
    print("0) Avsluta")

def show_movies(movies):
    print("Filmsamling")
    print("***********")
    for movie in movies:
        print("Titel: {}, betyg: {}".format(movie["title"], movie["rating"]))


def show_statistics(movies):
    nr_of_movies = len(movies)
    total_rating = 0
    for movie in movies:
        total_rating = total_rating + int(movie["rating"])

    avg_rating = total_rating/nr_of_movies
    print("Statistik")
    print("*********")
    print("Antal filmer: {}".format(nr_of_movies))
    print("Genomsnittsbetyg: {}".format(avg_rating))
        
def add_movie(movies):
    title = input("Ange titel på film: ")
    rating = input("Ange betyg: ")

    try:
        my_file = open("movies.txt", "a")
        my_file.write("\n{};{}".format(title, rating))
        my_file.close()

        movies.append({
            "title": title,
            "rating": rating
        })
    except:
        print("Det gick inte att öppna filen")

def get_movies_from_file(file_name):
    try:
        my_file = open(file_name, "r")
        #print(my_file.readlines())
        movies = []
        for line in my_file.readlines():
            movie_info = line.strip()
            movie_info = movie_info.split(";")
            movie = {
                    "title": movie_info[0],
                    "rating": movie_info[1]
                }
            movies.append(movie)

        my_file.close()
        return movies
            
    except:
        my_file = open(file_name, "w")
        my_file.close()
        movies = []
        return movies

main()
{% endhighlight %}

### Textfilen som filmerna sparas i

{% highlight text linenos %}
Star Wars;5
Titanic;4
Inception;4
Sagan om ringen;5
American Beauty;5
Hidden figures;4
{% endhighlight %}
