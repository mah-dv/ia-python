---
layout: instructions
title: Modul 4 - Fil- och felhantering
code: m5
---

# Fel- och filhantering

<iframe src="//www.slideshare.net/slideshow/embed_code/key/XDsgtWt6wzozq" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/AntonTibblin/ht18-da354a-fel-och-filhantering" title="HT18 - DA354A - Fel- och filhantering" target="_blank">HT18 - DA354A - Fel- och filhantering</a> </strong> from <strong><a href="https://www.slideshare.net/AntonTibblin" target="_blank">Anton Tibblin</a></strong> </div>

## Dagens exempelkod

### Lite exempel med try except

{% highlight python linenos %}
movies = ["Star Wars", "Inception", "Titanic", "American Beauty"]

while True:
    try:
        #index = int(input("Ange index för film: "))
        user_input = input("Ange index för film: ")
        if user_input.isdigit():
            print(movies[index])
            break
        else:
            print("Du måste ange en siffra")

    except ValueError:
        print("Du måste ange en siffra!")
    except IndexError:
        print("Du måste ange ett korrekt index, mellan 0 och {}".format(len(movies)-1))

'''
try:
    nr = int(input("Ange ett tal: "))
except:
    print("Du angav inte ett korrekt tal")
'''

{% endhighlight %}

### Att läsa och skriva från/till fil

{% highlight python linenos %}
try:
    my_file = open("name.txt", "r")
    print("Välkommen {}!".format(my_file.read()))
    my_file.close()
except:
    name = input("Vad heter du? ")
    my_file = open("name.txt", "w")
    my_file.write(name)
    my_file.close()

{% endhighlight %}

### Ett litet filmprogram

{% highlight python linenos %}
import time

def main():
    user_choice = None
    while user_choice != "0":
        print_menu()
        user_choice = input("Val: ")

        if user_choice == "1":
            print_movies()
        elif user_choice == "2":
            add_movie()
        elif user_choice == "0":
            pass
        else:
            print("Du valde ett ogiltligt alternativ")

def add_movie():
    movie = input("Titel på filmen: ")
    
    my_file = open("movies.txt", "a")
    my_file.write("{}\n".format(movie))
    my_file.close()


def print_movies():
    my_file = open("movies.txt", "r")
    movies = my_file.readlines()
    for movie in movies:
        time.sleep(1)
        print(movie, end="")

    my_file.close()

print_movies()

def print_menu():
    print("*"*40)
    print("Menu")
    print("*"*40)
    print("1) Visa filmer")
    print("2) Lägg till en film")
    print("0) Avsluta")

main()

{% endhighlight %}

### Filmexempel - En annan variant

{% highlight python linenos %}
def main():

    movies = get_movies_from_file("movies.txt")
    
    print("*"*40)
    print("Välkommen till din filmsamling!")
    print("*"*40)

    while True:
        print_menu()

        user_choice = input("Val: ")

        if user_choice == "1":
            show_movies(movies)
        elif user_choice == "2":
            add_movie(movies)
        elif user_choice == "3":
            show_statistics(movies)
        elif user_choice == "4":
            pass
        elif user_choice == "0":
            break
        else:
            print("Felaktigt alternativ, försök igen!")

def print_menu():
    print("Meny")
    print("*"*40)
    print("1) Visa filmer")
    print("2) Lägg till en film")
    print("3) Statistik")
    #print("4) Spara filmerna till fil")
    print("0) Avsluta")

def show_movies(movies):
    print("Filmsamling")
    print("***********")
    for movie in movies:
        print("Titel: {}, betyg: {}".format(movie["title"], movie["rating"]))


def show_statistics(movies):
    nr_of_movies = len(movies)
    total_rating = 0
    for movie in movies:
        total_rating = total_rating + int(movie["rating"])

    avg_rating = total_rating/nr_of_movies
    print("Statistik")
    print("*********")
    print("Antal filmer: {}".format(nr_of_movies))
    print("Genomsnittsbetyg: {}".format(avg_rating))
        
def add_movie(movies):
    title = input("Ange titel på film: ")
    rating = input("Ange betyg: ")

    try:
        my_file = open("movies.txt", "a")
        my_file.write("\n{};{}".format(title, rating))
        my_file.close()

        movies.append({
            "title": title,
            "rating": rating
        })
    except:
        print("Det gick inte att öppna filen")

def get_movies_from_file(file_name):
    try:
        my_file = open(file_name, "r")
        #print(my_file.readlines())
        movies = []
        for line in my_file.readlines():
            movie_info = line.strip()
            movie_info = movie_info.split(";")
            movie = {
                    "title": movie_info[0],
                    "rating": movie_info[1]
                }
            movies.append(movie)

        my_file.close()
        return movies
            
    except:
        my_file = open(file_name, "w")
        my_file.close()
        movies = []
        return movies

main()
{% endhighlight %}

### Textfilen som filmerna sparas i

{% highlight text linenos %}
Star Wars;5
Titanic;4
Inception;4
Sagan om ringen;5
American Beauty;5
Hidden figures;4
{% endhighlight %}
