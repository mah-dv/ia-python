---
layout: instructions
title: Modul 4 - Fil- och felhantering
code: m5
---

# Fel- och filhantering

## Dagens exempelkod

{% highlight python linenos %}
def main():

    movies = get_movies_from_file("movies.txt")

    print("*"*40)
    print("Välkommen till din filmsamling!")
    print("*"*40)

    while True:
        print_menu()

        user_choice = input("Val: ")

        if user_choice == "1":
            show_movies(movies)
        elif user_choice == "2":
            add_movie(movies)
        elif user_choice == "3":
            show_statistics(movies)
        elif user_choice == "4":
            delete_movie(movies)
        elif user_choice == "0":
            break
        else:
            print("Felaktigt alternativ, försök igen!")

def delete_movie(movies):
    movie_title = input("Vilken film vill du ta bort? ")

    for movie in movies:
        if movie["title"] == movie_title:
            # Ta bor film
            movies.remove(movie)

    save_movies_to_file(movies)

def save_movies_to_file(movies):
    my_file = open("movies.txt", "w")

    for movie in movies:
        my_file.write("\n{};{}".format(movie["title"], movie["rating"]))

    my_file.close()


def print_menu():
    print("Meny")
    print("*"*40)
    print("1) Visa filmer")
    print("2) Lägg till en film")
    print("3) Statistik")
    print("4) Radera en film")
    print("0) Avsluta")

def show_movies(movies):
    print("Filmsamling")
    print("***********")
    for movie in movies:
        print("Titel: {}, betyg: {}".format(movie["title"], movie["rating"]))


def show_statistics(movies):
    nr_of_movies = len(movies)
    total_rating = 0
    for movie in movies:
        total_rating = total_rating + int(movie["rating"])

    avg_rating = total_rating/nr_of_movies
    print("Statistik")
    print("*********")
    print("Antal filmer: {}".format(nr_of_movies))
    print("Genomsnittsbetyg: {}".format(avg_rating))

def add_movie(movies):
    title = input("Ange titel på film: ")
    rating = input("Ange betyg: ")

    try:
        my_file = open("movies.txt", "a")
        my_file.write("\n{};{}".format(title, rating))
        my_file.close()

        movies.append({
            "title": title,
            "rating": rating
        })
    except:
        print("Det gick inte att öppna filen")

def get_movies_from_file(file_name):
    try:
        my_file = open(file_name, "r")
        #print(my_file.readlines())
        movies = []
        for line in my_file.readlines():
            try:
                movie_info = line.strip()
                movie_info = movie_info.split(";")
                movie = {
                        "title": movie_info[0],
                        "rating": movie_info[1]
                    }
                movies.append(movie)
            except:
                pass

        my_file.close()
        return movies

    except:
        my_file = open(file_name, "w")
        my_file.close()
        movies = []
        return movies

main()

{% endhighlight %}
